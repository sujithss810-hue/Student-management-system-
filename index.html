<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Student Database</title>

<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:#ffffff;
}

h2{
    text-align:center;
    padding:15px;
    letter-spacing:1px;
    color:#00e5ff;
}

.container{
    max-width:1100px;
    margin:auto;
    padding:15px;
}

form{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
    gap:8px;
    background:#16222a;
    padding:15px;
    border-radius:10px;
    box-shadow:0 0 15px rgba(0,229,255,0.3);
}

input,select{
    padding:8px;
    border:1px solid #00e5ff;
    border-radius:6px;
    background:#0f2027;
    color:#fff;
    font-size:13px;
    outline:none;
}

input:focus,select:focus{
    box-shadow:0 0 8px #00e5ff;
}

button{
    padding:8px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-weight:bold;
    background:#00e5ff;
    color:#000;
    transition:0.3s;
}

button:hover{
    background:#00bcd4;
}

table{
    width:100%;
    margin-top:20px;
    border-collapse:collapse;
    background:#16222a;
    font-size:12px;
}

th,td{
    padding:7px;
    border:1px solid #0f2027;
    text-align:center;
}

th{
    background:#00bcd4;
    color:#000;
}

tr:nth-child(even){
    background:#1e2d38;
}

.edit{
    background:#4caf50;
    color:#fff;
    padding:4px 6px;
}

.del{
    background:#f44336;
    color:#fff;
    padding:4px 6px;
}

@media(max-width:600px){
    table{font-size:9px;}
}
</style>
</head>

<body>

<h2>Student Database Management</h2>

<div class="container">

<form id="f">

<input id="n" placeholder="Name" required>
<input type="date" id="dob" required>
<input id="age" placeholder="Age" readonly>

<select id="course">
<option value="">Select Course (Optional)</option>
<option>BCA</option><option>BSc</option><option>BCom</option>
<option>BA</option><option>BBA</option><option>BE</option>
<option>BTech</option><option>MCA</option><option>MSc</option>
<option>MCom</option><option>MA</option><option>MBA</option>
<option>Diploma</option><option>Pharmacy</option><option>Nursing</option>
</select>

<input id="ugno" placeholder="UG No" required>
<input id="year" placeholder="Passing Year" required>

<!-- Attendance validation added -->
<input type="number" id="att" placeholder="Attendance %" min="0" max="100" required>

<select id="gen" required>
<option value="">Select Gender</option>
<option>Male</option>
<option>Female</option>
<option>Other</option>
</select>

<input id="ph" placeholder="Phone No" required>
<input id="em" placeholder="Email" required>
<input id="loc" placeholder="Location" required>

<button id="btn">Add Student</button>

</form>

<table>
<thead>
<tr>
<th>Name</th>
<th>Date of Birth</th>
<th>Age</th>
<th>Course</th>
<th>UG No</th>
<th>Year</th>
<th>Attendance %</th>
<th>Gender</th>
<th>Phone</th>
<th>Email</th>
<th>Location</th>
<th>Action</th>
</tr>
</thead>
<tbody id="t"></tbody>
</table>

</div>

<script>

let students = JSON.parse(localStorage.getItem("db2")) || [];
let editIndex = -1;

const form = document.getElementById("f");
const tableBody = document.getElementById("t");
const button = document.getElementById("btn");

/* ===== Accurate Age Calculation ===== */

dob.addEventListener("change", function(){

    let birthDate = new Date(this.value);
    let today = new Date();

    let ageCalc = today.getFullYear() - birthDate.getFullYear();
    let monthDiff = today.getMonth() - birthDate.getMonth();

    if(monthDiff < 0 || 
      (monthDiff === 0 && today.getDate() < birthDate.getDate())){
        ageCalc--;
    }

    age.value = ageCalc;
});

/* ===== Display ===== */

function display(){

    tableBody.innerHTML = "";

    students.forEach(function(stu,index){

        tableBody.innerHTML += `
        <tr>
            <td>${stu.n}</td>
            <td>${stu.dob}</td>
            <td>${stu.age}</td>
            <td>${stu.course}</td>
            <td>${stu.ugno}</td>
            <td>${stu.year}</td>
            <td>${stu.att}%</td>
            <td>${stu.gen}</td>
            <td>${stu.ph}</td>
            <td>${stu.em}</td>
            <td>${stu.loc}</td>
            <td>
                <button class="edit" onclick="editStudent(${index})">Edit</button>
                <button class="del" onclick="deleteStudent(${index})">Delete</button>
            </td>
        </tr>
        `;
    });

    localStorage.setItem("db2", JSON.stringify(students));
}

/* ===== Submit ===== */

form.addEventListener("submit", function(e){

    e.preventDefault();

    let attendanceValue = parseInt(att.value);

    if(attendanceValue < 0 || attendanceValue > 100){
        alert("Attendance must be between 0 and 100 only!");
        return;
    }

    let data = {
        n:n.value,
        dob:dob.value,
        age:age.value,
        course:course.value,
        ugno:ugno.value,
        year:year.value,
        att:attendanceValue,
        gen:gen.value,
        ph:ph.value,
        em:em.value,
        loc:loc.value
    };

    if(editIndex === -1){
        students.push(data);
    }else{
        students[editIndex] = data;
        editIndex = -1;
        button.textContent = "Add Student";
    }

    form.reset();
    display();
});

/* ===== Edit ===== */

function editStudent(i){

    let s = students[i];

    n.value=s.n;
    dob.value=s.dob;
    age.value=s.age;
    course.value=s.course;
    ugno.value=s.ugno;
    year.value=s.year;
    att.value=s.att;
    gen.value=s.gen;
    ph.value=s.ph;
    em.value=s.em;
    loc.value=s.loc;

    editIndex=i;
    button.textContent="Update Student";
}

/* ===== Delete ===== */

function deleteStudent(i){
    if(confirm("Delete this student?")){
        students.splice(i,1);
        display();
    }
}

display();

</script>

</body>
</html>
